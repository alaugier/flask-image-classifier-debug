<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>R√©sultat</title>
    <style>
      body { font-family: system-ui, sans-serif; margin: 2rem; }
      img { max-width: 420px; border-radius: 10px; display: block; margin-bottom: 1rem; }
      .pill { padding:.5rem 1rem; margin-right:.5rem; border-radius:999px; border:1px solid #aaa; background:#f5f5f5; cursor:pointer; transition: all 0.2s; }
      .pill:hover { background:#e5e5e5; border-color:#888; }
      .pill.selected { background:#007bff; color:white; border-color:#007bff; }
      .btn { padding:.6rem 1rem; border-radius:8px; border:1px solid #222; background:#fff; text-decoration:none; display:inline-block; margin-top:1rem; }
      .feedback-section { margin-top: 2rem; padding: 1rem; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; }
      .feedback-message { padding: 0.5rem; margin-top: 1rem; border-radius: 4px; display: none; }
      .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
      .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
  </head>
  <body>
    <h1>R√©sultat</h1>
    <img id="resultImage" src="{{ image_data_url }}" alt="submitted image" />
    <h2>Classe pr√©dite : {{ predicted_label }}</h2>
    <p>Confiance : {{ '%.3f'|format(confidence) }}</p>
    
    <div class="feedback-section">
      <h3>Cette pr√©diction vous semble-t-elle correcte ?</h3>
      <p>Cliquez sur la classe correcte selon vous :</p>
      <div id="classButtons">
        {% for c in classes %}
          <button class="pill" data-class="{{ c }}">{{ c }}</button>
        {% endfor %}
      </div>
      <div class="feedback-message" id="feedbackMessage"></div>
    </div>
    
    <p><a href="/">‚Ü©Ô∏é Revenir</a></p>

    <script>
      (function() {
        const buttons = document.querySelectorAll('.pill');
        const feedbackMessage = document.getElementById('feedbackMessage');
        const resultImage = document.getElementById('resultImage');
        
        const feedbackData = {
          image_data: "{{ image_data_url }}",
          predicted_label: "{{ predicted_label }}",
          predicted_confidence: {{ confidence }},
          user_label: null
        };

        buttons.forEach(button => {
          button.addEventListener('click', function() {
            // Retirer la s√©lection pr√©c√©dente
            buttons.forEach(b => b.classList.remove('selected'));
            
            // S√©lectionner le bouton cliqu√©
            this.classList.add('selected');
            
            const selectedClass = this.getAttribute('data-class');
            feedbackData.user_label = selectedClass;
            
            // Envoyer le feedback
            sendFeedback(feedbackData);
          });
        });

        function sendFeedback(data) {
          fetch('/feedback', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          })
          .then(response => response.json())
          .then(result => {
            if (result.status === 'success') {
              showMessage('Merci pour votre feedback ! üéâ', 'success');
            } else {
              showMessage('Erreur lors de l\'envoi du feedback.', 'error');
            }
          })
          .catch(error => {
            console.error('Erreur:', error);
            showMessage('Erreur lors de l\'envoi du feedback.', 'error');
          });
        }

        function showMessage(text, type) {
          feedbackMessage.textContent = text;
          feedbackMessage.className = `feedback-message ${type}`;
          feedbackMessage.style.display = 'block';
          
          // Masquer le message apr√®s 3 secondes
          setTimeout(() => {
            feedbackMessage.style.display = 'none';
          }, 3000);
        }
      })();
    </script>
  </body>
</html>